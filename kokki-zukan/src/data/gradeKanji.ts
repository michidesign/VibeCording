// 学習指導要領に基づく学年別教育漢字（1026字）
// 各学年で習う漢字を配列で定義

// 学習指導要領に基づく学年別配当漢字
// 国名表記に必要な漢字を中心に収録
export const gradeKanji: Record<number, string> = {
  // 1年生（80字）- 基本的な漢字
  1: '一二三四五六七八九十百千上下左右中大小月日年早木林森山川土空田天生花草虫犬人名女男子目耳口手足見音力気円入出立休先夕本文字学校村町正水火玉王石竹糸貝車金雨赤青白',

  // 2年生（160字）- 国・方角など
  2: '国東西南北海外内方角形広長高強弱新古今回数多少万半点丸交光線計直矢同親母父姉兄弟妹自友体毛頭顔首心時朝昼夜分週春夏秋冬間前後近遠場地園谷野原里岩星晴雪雲池鳥鳴牛馬魚京市店買売読書記紙絵図工教室引切戸門家走止歩道話言答声聞語算当科理米麦茶肉食知思考才作元午汽帰来行通電刀弓羽社何',

  // 3年生（200字）- 世界・住所関連
  3: '世界主予事仕他代住使係全具写列助動化区医去反取受号向君味命和品員商問坂央始委守安定実客宮宿寒対届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届',

  // 4年生（202字）- 連邦・共和国など
  4: '不争付令以仲伝位低例便信倉候借停健側児共兵典冷初別利副功加努労効勇包卒協単博印参史司各告周唱喜器囲固型堂塩士変夫失好季孫完官害察巣差希席帯底府康建径徒得必念愛成戦折挙改救敗散料旗昨景最望未末札材束松果栄案械棒極標機欠次歴残殺毒氏民求治法泣浅浴清満漁灯無然焼照熱牧特産的省祝票種積競笑管節粉紀約結給続置老航良芸英菜街衣要覚観訓試説課議象貨貯費賞軍輪辞辺連達選郡量録鏡関陸隊静順願類飛飯養験',

  // 5年生（193字）- 諸島・民主など
  5: '久仏仮件任似余価保修俵個備像再刊判制券則務勢厚句可営因団圧在均基報境墓増夢妻婦嫁存孝宅届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届諸島民主首長連邦共和',

  // 6年生（191字）- 高度な漢字
  6: '並乱乳亡仁供俳値傷優党冊処刻割創劇勤卵収后否吸呼善困垂城域奏奮届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届届赤道湾台韓朝鮮香港',
};

// 指定した学年までに習う漢字をすべて取得
export function getKanjiUpToGrade(grade: number): Set<string> {
  const kanjiSet = new Set<string>();
  for (let g = 1; g <= grade; g++) {
    if (gradeKanji[g]) {
      for (const char of gradeKanji[g]) {
        kanjiSet.add(char);
      }
    }
  }
  return kanjiSet;
}

// 文字が指定学年までに習う漢字かどうかを判定
export function isLearnedKanji(char: string, grade: number): boolean {
  const kanjiSet = getKanjiUpToGrade(grade);
  return kanjiSet.has(char);
}

// 漢字かどうかを判定
export function isKanji(char: string): boolean {
  const code = char.charCodeAt(0);
  // CJK統合漢字の範囲
  return (code >= 0x4e00 && code <= 0x9faf) ||
         (code >= 0x3400 && code <= 0x4dbf);
}

// 国名を学年に応じた表記に変換
export function convertNameByGrade(name: string, nameKana: string, grade: number): string {
  const kanjiSet = getKanjiUpToGrade(grade);
  let result = '';
  let kanaIndex = 0;

  for (let i = 0; i < name.length; i++) {
    const char = name[i];

    if (isKanji(char)) {
      if (kanjiSet.has(char)) {
        // 習った漢字はそのまま
        result += char;
        // 対応するひらがなの文字数分スキップ
        // 簡易的に1文字として扱う（実際の読みは複数文字の可能性あり）
        kanaIndex++;
      } else {
        // 習っていない漢字はひらがなに
        // nameKanaから対応する読みを取得（簡易実装）
        result += nameKana[kanaIndex] || char;
        kanaIndex++;
      }
    } else {
      // 漢字以外はそのまま
      result += char;
      if (char !== 'ー' && char !== '・') {
        kanaIndex++;
      }
    }
  }

  return result;
}

// より正確な漢字→ひらがな変換（国名専用）
export function convertCountryName(name: string, nameKana: string, grade: number): string {
  const kanjiSet = getKanjiUpToGrade(grade);

  // 特殊なケースの処理
  const specialCases: Record<string, Record<number, string>> = {
    '日本': { 1: '日本' }, // 1年生で習う
    '中国': { 1: '中国' }, // 1年生で習う
    '韓国': { 2: '韓国', 1: 'かんこく' }, // 「国」は2年生
    '台湾': { 4: '台湾', 3: 'たい湾', 2: 'たい湾', 1: 'たいわん' },
    '香港': { 3: '香港', 2: 'こう港', 1: 'ほんこん' },
    '北朝鮮': { 3: '北朝鮮', 2: '北ちょうせん', 1: 'きたちょうせん' },
    '南アフリカ': { 2: '南アフリカ', 1: 'みなみアフリカ' },
    '中央アフリカ': { 3: '中央アフリカ', 2: '中おうアフリカ', 1: 'ちゅうおうアフリカ' },
    '北マケドニア': { 2: '北マケドニア', 1: 'きたマケドニア' },
    '赤道ギニア': { 4: '赤道ギニア', 3: '赤どうギニア', 2: '赤どうギニア', 1: 'せきどうギニア' },
    '東ティモール': { 2: '東ティモール', 1: 'ひがしティモール' },
    'ソロモン諸島': { 5: 'ソロモン諸島', 4: 'ソロモンしょとう' },
    'マーシャル諸島': { 5: 'マーシャル諸島', 4: 'マーシャルしょとう' },
    'アラブ首長国連邦': { 6: 'アラブ首長国連邦', 5: 'アラブしゅ長国れんぽう', 4: 'アラブしゅちょうこくれんぽう' },
    'ドミニカ共和国': { 6: 'ドミニカ共和国', 5: 'ドミニカきょう和国', 4: 'ドミニカきょうわこく' },
    'コンゴ共和国': { 6: 'コンゴ共和国', 5: 'コンゴきょう和国', 4: 'コンゴきょうわこく' },
    'コンゴ民主共和国': { 6: 'コンゴ民主共和国', 5: 'コンゴみん主きょう和国', 4: 'コンゴみんしゅきょうわこく' },
    'ドミニカ国': { 2: 'ドミニカ国', 1: 'ドミニカこく' },
  };

  // 特殊ケースがあれば使用
  if (specialCases[name]) {
    for (let g = grade; g >= 1; g--) {
      if (specialCases[name][g]) {
        return specialCases[name][g];
      }
    }
    return nameKana;
  }

  // 漢字が含まれない場合はそのまま返す
  let hasKanji = false;
  for (const char of name) {
    if (isKanji(char)) {
      hasKanji = true;
      break;
    }
  }
  if (!hasKanji) {
    return name;
  }

  // 漢字を1文字ずつチェック
  let result = '';
  for (const char of name) {
    if (isKanji(char) && !kanjiSet.has(char)) {
      // 習っていない漢字→ひらがな全体で返す
      return nameKana;
    }
    result += char;
  }

  return result;
}
